<!--pages/card/card.wxml-->
<view class="page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="nav-header">
    <view class="nav-info">
      <text class="nav-mode">{{modeText}}</text>
      <text class="nav-progress">{{currentIndex + 1}}/{{totalCount}}</text>
    </view>
    <view class="nav-actions">
      <view class="action-btn" bindtap="toggleCollection">
        <text class="{{isCollected ? 'icon-collected' : 'icon-collect'}}">{{isCollected ? 'â¤ï¸' : 'ğŸ¤'}}</text>
      </view>
    </view>
  </view>

  <!-- æˆè¯­å¡ç‰‡ -->
  <view class="idiom-card card" wx:if="{{currentIdiom}}">
    <!-- å¡ç‰‡æ­£é¢ -->
    <view class="card-front" wx:if="{{!showBack}}">
      <view class="idiom-main">
        <view class="idiom-text">{{currentIdiom.idiom}}</view>
        <view class="idiom-pinyin">{{currentIdiom.pinyin}}</view>
        <view class="idiom-difficulty">
          <text class="difficulty-tag difficulty-chuji" wx:if="{{currentIdiom.difficulty === 'åˆçº§'}}">{{currentIdiom.difficulty}}</text>
          <text class="difficulty-tag difficulty-zhongji" wx:if="{{currentIdiom.difficulty === 'ä¸­çº§'}}">{{currentIdiom.difficulty}}</text>
          <text class="difficulty-tag difficulty-gaoji" wx:if="{{currentIdiom.difficulty === 'é«˜çº§'}}">{{currentIdiom.difficulty}}</text>
          <text class="category-tag">{{currentIdiom.category}}</text>
        </view>
      </view>
      
      <view class="card-actions">
        <button class="btn-secondary" bindtap="showMeaning">æŸ¥çœ‹é‡Šä¹‰</button>
        <button class="btn-primary" bindtap="showStory">æŸ¥çœ‹æ•…äº‹</button>
      </view>
    </view>

    <!-- å¡ç‰‡èƒŒé¢ - é‡Šä¹‰ -->
    <view class="card-back" wx:if="{{showBack && backType === 'meaning'}}">
      <view class="back-header">
        <view class="back-title">æˆè¯­é‡Šä¹‰</view>
        <view class="back-close" bindtap="flipCard">Ã—</view>
      </view>
      <view class="meaning-content">
        <view class="meaning-text">{{currentIdiom.meaning}}</view>
        <view class="moral-text" wx:if="{{currentIdiom.moral}}">
          <text class="moral-label">å¯“æ„ï¼š</text>
          <text>{{currentIdiom.moral}}</text>
        </view>
      </view>
      <view class="card-actions">
        <button class="btn-secondary" bindtap="showStory">æŸ¥çœ‹æ•…äº‹</button>
        <button class="btn-primary" bindtap="markLearned">å·²æŒæ¡</button>
      </view>
    </view>

    <!-- å¡ç‰‡èƒŒé¢ - æ•…äº‹ -->
    <view class="card-back" wx:if="{{showBack && backType === 'story'}}">
      <view class="back-header">
        <view class="back-title">æˆè¯­æ•…äº‹</view>
        <view class="back-close" bindtap="flipCard">Ã—</view>
      </view>
      <scroll-view class="story-content" scroll-y="true">
        <view class="story-text">{{currentIdiom.story}}</view>
        <view class="story-source" wx:if="{{currentIdiom.source}}">
          <text class="source-label">å‡ºå¤„ï¼š</text>
          <text>{{currentIdiom.source}}</text>
        </view>
      </scroll-view>
      <view class="card-actions">
        <button class="btn-secondary" bindtap="showMeaning">æŸ¥çœ‹é‡Šä¹‰</button>
        <button class="btn-primary" bindtap="markLearned">å·²æŒæ¡</button>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions">
    <button class="nav-btn" bindtap="previousCard" disabled="{{currentIndex === 0}}">
      <text class="nav-icon">â€¹</text>
      <text class="nav-text">ä¸Šä¸€ä¸ª</text>
    </button>
    
    <view class="center-actions">
      <button class="action-btn" bindtap="flipCard">
        <text class="action-icon">ğŸ”„</text>
        <text class="action-text">ç¿»è½¬</text>
      </button>
      <button class="action-btn" bindtap="speakIdiom">
        <text class="action-icon">ğŸ”Š</text>
        <text class="action-text">æœ—è¯»</text>
      </button>
    </view>

    <button class="nav-btn" bindtap="nextCard" disabled="{{currentIndex === totalCount - 1}}">
      <text class="nav-text">ä¸‹ä¸€ä¸ª</text>
      <text class="nav-icon">â€º</text>
    </button>
  </view>

  <!-- å­¦ä¹ å®Œæˆæç¤º -->
  <view class="completion-modal" wx:if="{{showCompletion}}">
    <view class="modal-content card">
      <view class="completion-icon">ğŸ‰</view>
      <view class="completion-title">å­¦ä¹ å®Œæˆï¼</view>
      <view class="completion-stats">
        <text>æœ¬æ¬¡å­¦ä¹ äº† {{learnedCount}} ä¸ªæˆè¯­</text>
      </view>
      <view class="completion-actions">
        <button class="btn-secondary" bindtap="backToHome">è¿”å›é¦–é¡µ</button>
        <button class="btn-primary" bindtap="restartLearning">é‡æ–°å­¦ä¹ </button>
      </view>
    </view>
  </view>
</view>